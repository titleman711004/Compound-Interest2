<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¤‡åˆ©å¤§å¸«</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --primary-color: #8ab4f8;
            --text-color: #e8eaed;
            --accent-color: #3c4043;
            --footer-text: #999;
        }

        /* å½©è™¹é…è‰² */
        [data-theme="red"] { --primary-color: #ff5252; --accent-color: #4a2b2b; }
        [data-theme="orange"] { --primary-color: #ffab40; --accent-color: #4a3b2b; }
        [data-theme="yellow"] { --primary-color: #ffd740; --accent-color: #4a462b; }
        [data-theme="green"] { --primary-color: #69f0ae; --accent-color: #2b4a3a; }
        [data-theme="blue"] { --primary-color: #40c4ff; --accent-color: #2b3e4a; }
        [data-theme="indigo"] { --primary-color: #7c4dff; --accent-color: #342b4a; }
        [data-theme="purple"] { --primary-color: #e040fb; --accent-color: #472b4a; }
        [data-theme="classic-blue"] { --bg-color: #f0f2f5; --card-bg: #ffffff; --primary-color: #1a73e8; --text-color: #333; --accent-color: #e8f0fe; --footer-text: #666; }

        body {
            font-family: -apple-system, "Segoe UI", "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 15px; transition: all 0.3s ease;
            min-height: 100vh; display: flex; flex-direction: column;
        }

        header {
            max-width: 1000px; width: 100%; margin: 0 auto 20px;
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;
        }

        .theme-switcher {
            padding: 8px 12px; border-radius: 20px; border: 1px solid var(--primary-color);
            background: var(--card-bg); color: var(--text-color); cursor: pointer; outline: none;
        }

        .container {
            max-width: 1000px; margin: 0 auto; display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; flex-grow: 1; width: 100%;
        }

        .card {
            background: var(--card-bg); padding: 25px; border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: flex; flex-direction: column;
            border: 1px solid rgba(255,255,255,0.05); position: relative;
        }

        .card.featured { grid-column: span 1; border: 1.5px solid var(--primary-color); }
        @media (min-width: 900px) { .card.featured { grid-column: span 2; } }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        h2 { margin: 0; font-size: 1.3em; border-left: 5px solid var(--primary-color); padding-left: 10px; }

        .btn-screenshot {
            background: transparent; border: 1px solid var(--primary-color); color: var(--primary-color);
            border-radius: 6px; padding: 4px 8px; font-size: 0.75rem; cursor: pointer; transition: 0.2s;
        }
        .btn-screenshot:hover { background: var(--primary-color); color: #fff; }

        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.85rem; opacity: 0.9; }
        input {
            width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
            background: rgba(0,0,0,0.2); color: #fff; box-sizing: border-box; font-size: 1rem;
        }

        [data-theme="classic-blue"] input { background: #fff; color: #333; border: 1px solid #ddd; }

        .result {
            margin: 15px 0; padding: 15px; background: var(--accent-color);
            border-radius: 10px; font-size: 1.1rem; line-height: 1.6;
        }

        .chart-container { position: relative; height: 300px; width: 100%; margin-top: 10px; }

        footer { text-align: center; padding: 30px 0; color: var(--footer-text); font-size: 0.9rem; }
    </style>
</head>
<body data-theme="dark">

<header>
    <h1>ğŸ“ˆ è¤‡åˆ©è¨ˆç®—</h1>
    <select class="theme-switcher" id="themeSelect">
        <option value="dark">ğŸŒ™ æ¥µè‡´æ·±è‰²</option>
        <option value="red">ğŸ”´ ç†±æƒ…ç´…</option>
        <option value="orange">ğŸŸ  æ´»åŠ›æ©™</option>
        <option value="yellow">ğŸŸ¡ æ˜äº®é»ƒ</option>
        <option value="green">ğŸŸ¢ ç”Ÿæ©Ÿç¶ </option>
        <option value="blue">ğŸ”µ æ¹›è—è‰²</option>
        <option value="indigo">ğŸ”® é›è—è‰²</option>
        <option value="purple">ğŸŸ£ å¤¢å¹»ç´«</option>
        <option value="classic-blue">ğŸŒ ç¶“å…¸äº®è—</option>
    </select>
</header>

<div class="container">
    <div class="card featured" id="capture-mix">
        <div class="card-header">
            <h2>ğŸ’° ç¶œåˆè¤‡åˆ© (æœ¬é‡‘+æœˆå­˜)</h2>
            <button class="btn-screenshot" onclick="takeScreenshot('capture-mix', 'Titleman_è³‡ç”¢åˆ†æ')">ğŸ“¸</button>
        </div>
        <div class="input-grid">
            <div class="input-group">
                <label>åˆå§‹æœ¬é‡‘ ($)</label>
                <input type="number" id="p_mix" value="500000">
            </div>
            <div class="input-group">
                <label>æ¯æœˆçºŒå­˜é¡ ($)</label>
                <input type="number" id="m_mix" value="10000">
            </div>
            <div class="input-group">
                <label>å¹´åŒ–å ±é…¬ç‡ (%)</label>
                <input type="number" id="r_mix" value="7">
            </div>
            <div class="input-group">
                <label>æŠ•è³‡å¹´æ•¸</label>
                <input type="number" id="t_mix" value="20">
            </div>
        </div>
        <div class="result" id="res_mix"></div>
        <div class="chart-container"><canvas id="chart_mix"></canvas></div>
    </div>

    <div class="card" id="capture-target">
        <div class="card-header">
            <h2>ğŸ¯ ç›®æ¨™åæ¨</h2>
            <button class="btn-screenshot" onclick="takeScreenshot('capture-target', 'Titleman_ç›®æ¨™è¦åŠƒ')">ğŸ“¸</button>
        </div>
        <div class="input-group">
            <label>è¨­å®šè³‡ç”¢ç›®æ¨™ ($)</label>
            <input type="number" id="target" value="10000000">
        </div>
        <div class="input-group">
            <label>é æœŸå ±é…¬ç‡ (%)</label>
            <input type="number" id="r_target" value="7">
        </div>
        <div class="input-group">
            <label>è¦åŠƒé”æˆå¹´æ•¸</label>
            <input type="number" id="t_target" value="25">
        </div>
        <div class="result" id="res_target"></div>
        <div class="chart-container"><canvas id="chart_target"></canvas></div>
    </div>
</div>

<footer>2026 Copyright Â© Titleman</footer>

<script>
    let charts = {};
    const fieldIds = ['p_mix', 'm_mix', 'r_mix', 't_mix', 'target', 'r_target', 't_target'];

    // æˆªåœ–åŠŸèƒ½
    function takeScreenshot(elementId, fileName) {
        const element = document.getElementById(elementId);
        // æš«æ™‚éš±è—æŒ‰éˆ•é¿å…æˆªé€²å»
        const btn = element.querySelector('.btn-screenshot');
        btn.style.visibility = 'hidden';

        html2canvas(element, {
            backgroundColor: getComputedStyle(document.body).getPropertyValue('--bg-color'),
            scale: 2, // æé«˜è§£æåº¦
            logging: false,
            useCORS: true
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `${fileName}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            btn.style.visibility = 'visible';
        });
    }

    window.onload = () => {
        const savedTheme = localStorage.getItem('app-theme') || 'dark';
        document.body.setAttribute('data-theme', savedTheme);
        document.getElementById('themeSelect').value = savedTheme;

        fieldIds.forEach(id => {
            const savedVal = localStorage.getItem(id);
            if (savedVal) document.getElementById(id).value = savedVal;
            document.getElementById(id).addEventListener('input', updateAll);
        });

        document.getElementById('themeSelect').addEventListener('change', (e) => {
            const theme = e.target.value;
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('app-theme', theme);
            updateAll(); 
        });
        updateAll();
    };

    function updateAll() {
        fieldIds.forEach(id => localStorage.setItem(id, document.getElementById(id).value));
        renderMixed();
        renderGoal();
    }

    function getThemeColor() {
        return getComputedStyle(document.body).getPropertyValue('--primary-color').trim();
    }

    function renderMixed() {
        const P = parseFloat(document.getElementById('p_mix').value) || 0;
        const M = parseFloat(document.getElementById('m_mix').value) || 0;
        const rY = (parseFloat(document.getElementById('r_mix').value) || 0) / 100;
        const rM = rY / 12;
        const t = parseInt(document.getElementById('t_mix').value) || 0;
        let assetData = [P];
        let costData = [P];
        for(let y=1; y<=t; y++) {
            const months = y * 12;
            const fromP = P * Math.pow(1 + rM, months);
            const fromM = rM > 0 ? M * ((Math.pow(1 + rM, months) - 1) / rM) * (1 + rM) : M * months;
            assetData.push((fromP + fromM).toFixed(0));
            costData.push(P + (M * months));
        }
        const finalAsset = assetData[assetData.length-1];
        const finalCost = costData[costData.length-1];
        document.getElementById('res_mix').innerHTML = `æœŸæœ«ç¸½é¡ï¼š<strong>$${Number(finalAsset).toLocaleString()}</strong><br>æŠ•å…¥æœ¬é‡‘ï¼š$${finalCost.toLocaleString()}<br>ç´¯ç©ç²åˆ©ï¼š<span style="color:var(--primary-color); font-weight:bold;">$${(finalAsset - finalCost).toLocaleString()}</span>`;
        drawDoubleChart('chart_mix', assetData, costData);
    }

    function renderGoal() {
        const target = parseFloat(document.getElementById('target').value) || 0;
        const rY = (parseFloat(document.getElementById('r_target').value) || 0) / 100;
        const rM = rY / 12;
        const t = parseInt(document.getElementById('t_target').value) || 0;
        const n = t * 12;
        let monthly = rM > 0 ? (target * rM) / ((Math.pow(1+rM, n) - 1) * (1+rM)) : target / n;
        document.getElementById('res_target').innerHTML = `æ¯æœˆéœ€å­˜ï¼š<strong>$${Math.ceil(monthly).toLocaleString()}</strong>`;
        let assetData = [0];
        let costData = [0];
        for(let y=1; y<=t; y++) {
            const val = rM > 0 ? monthly * ((Math.pow(1+rM, y*12) - 1) / rM) * (1+rM) : monthly * 12 * y;
            assetData.push(val.toFixed(0));
            costData.push((monthly * 12 * y).toFixed(0));
        }
        drawDoubleChart('chart_target', assetData, costData);
    }

    function drawDoubleChart(id, assetData, costData) {
        const ctx = document.getElementById(id).getContext('2d');
        if (charts[id]) charts[id].destroy();
        const primaryColor = getThemeColor();
        const isDark = document.body.getAttribute('data-theme') !== 'classic-blue';
        charts[id] = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({length: assetData.length}, (_, i) => `${i}Y`),
                datasets: [
                    { label: 'å«æ¯ç¸½è³‡ç”¢', data: assetData, borderColor: primaryColor, backgroundColor: primaryColor + '33', fill: true, tension: 0.4, pointRadius: 0 },
                    { label: 'ç´¯è¨ˆæŠ•å…¥æœ¬é‡‘', data: costData, borderColor: isDark ? '#ffffff66' : '#999', borderDash: [5, 5], backgroundColor: 'transparent', fill: false, tension: 0, pointRadius: 0 }
                ]
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: { legend: { display: true, position: 'top', labels: { color: isDark ? '#fff' : '#333', boxWidth: 12 } } },
                scales: { 
                    x: { ticks: { color: isDark ? '#aaa' : '#666' }, grid: { color: isDark ? '#333' : '#eee' } },
                    y: { ticks: { color: isDark ? '#aaa' : '#666', callback: v => v >= 10000 ? (v/10000)+'è¬' : v }, grid: { color: isDark ? '#333' : '#eee' } }
                }
            }
        });
    }
</script>
</body>
</html>

